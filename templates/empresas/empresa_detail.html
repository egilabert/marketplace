{% extends "app_base.html" %}
{% load static %}
{% block page_title %}
{{ empresa.name }}
{% endblock %}

{% block content %}

<div class="parallax-container">
    <div class="parallax"><img src="{% static 'images/cambodia-1476378_1920.jpg' %}"></div>
</div>

<div class="container">
    <h2>{{ empresa.name }}</h2>
    <h5 class="light">CNAE: {{ empresa.cnae }}</h5>
    <h6 class="light">{{ empresa.origin_reference.count }} transfers ({{ empresa.average_transfer | floatformat }} average transfer amount)</h6>
    <h6 class="light">{{ empresa.empresa.count }} Recomendaciones</h6>

    <h3 class="light">Recommended for this client</h3>

    {% if empresa.origin_reference.all %}
    <div class="row">
            <table class="highlight">
                <thead>
                    <tr>
                        <th data-field="empresa_recomendada">Empresa</th>
                        <th data-field="scoring">Scoring</th>
                        <th data-field="scoring">Sector</th>
                        <th data-field="scoring">CNAE</th>
                    </tr>
                </thead>

            
                <tbody>
                    {% for company in empresa.empresa.all %}
                        <tr>
                            <td><a href="{% url 'empresas:empresa_detail' company.clientes_recomendados.id %}">{{ company.clientes_recomendados.name }}</a></td>
                            <td>{{ company.similarity }}</td>
                            <td>{{ company.clientes_recomendados.sector }}</td>
                            <td>{{ company.clientes_recomendados.cnae }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    {% else %}

        <p>No companies are available.</p>

    {% endif %}


    <h3 class="light">Recent transfers</h3>

    {% if empresa.origin_reference.all %}
    <div class="row">
            <table class="highlight">
                <thead>
                    <tr>
                        <th data-field="origin_id">Origin</th>
                        <th data-field="concept">Concept</th>
                        <th data-field="amount">Amount</th>
                        <th data-field="balance">Balance</th>
                        <th data-field="destination_id">Destination</th>
                        <th data-field="date">Date</th>
                        <th data-field="date">Detail</th>
                    </tr>
                </thead>

            
                <tbody>
                    {% for transfer in empresa.origin_reference.all %}
                        <tr>
                            <td><a href="{% url 'empresas:empresa_detail' transfer.origin_reference.id %}">{{ transfer.origin_reference.name }}</a></td>
                            <td>{{ transfer.concept }}</td>
                            <td>{{ transfer.amount }}</td>
                            <td>{{ transfer.balance }}</td>
                            <td><a href="{% url 'empresas:empresa_detail' transfer.destination_reference.id %}">{{transfer.destination_reference.name }}</a></td>
                            <td>{{ transfer.operation_data|date }}</td>
                            <td><a href="{% url 'empresas:transfer_detail' transfer.id %}">Detail</a></td>

                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    {% else %}

        <p>No transfers are available.</p>

    {% endif %}

    <h3 class="light">Add your transfer</h3>
    
    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

    <form action="{% url 'empresas:transfer_create' empresa.id %}" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Add" />
    </form>
</div>


{% endblock %}