{% extends "base.html" %}
{% load urlify %}
{% load crispy_forms_tags %}

{% block post_detail_link %}
	<li><a href="{{object_list.get_absolute_url}}">{{object_list.title}}</a></li>
{% endblock %}

{% block content %}

<div class='col-sm-8 col-sm-offset-2'>
	{% if object_list.image %}
	<img src={{object_list.image.url}} class='img-responsive'/>
	{% endif %}
	<h1>{{ title }} <small>{%if object_list.draft %}<span style="color:red">Draft</span></small> {%endif%}<small>{{object_list.publish}}</small></h1>
	{% if object_list.user.get_full_name %}
	<p>Author: {{ object_list.user.get_full_name }} | Read time: {{ object_list.read_time}} min</p>
	{% else %}
	<p>Author: {{ object_list.user }} | Read time: {{ object_list.read_time}} min</p>
	{% endif %}

	<hr/>

	<div class='row'>
		<div class='col-sm-12 '>
   			<div class='post-detail-item'>{{ object_list.get_html }}</div>
		</div>
	</div>
	<p><div class="fb-like" data-href="{{ request.build_absolute_uri }}" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>
	<hr/>
	</p>
	<hr>
	<div class="row">
		<p class="lead">Comments</p>
		{% if request.user.is_authenticated %}
		<form method="POST" action=".">
			{{comment_form|crispy}}
			<input type="submit" name="" value="Post comment" class="btn btn-default">{% csrf_token %}
		</form>
		{% else %}
		<p>You must login to comment</p>
		{% endif %}
		<br/>
		{% for comment in comments %}
			<blockquote>
				<p>{{comment.content}}</p>
				<footer>via {{comment.user}} <cite title="{{comment.timestamp|timesince}}">{{comment.timestamp|timesince}}</cite> | {% if comment.children.count > 0 %} {{comment.children.count}} Comment {% if comment.children.count > 1 %} s {% endif %} |{% endif %} <a class="comment-reply-btn" href="#" >Reply</a> | <a class="" href="{{ comment.get_absolut_url }}" >Thread</a></footer>
				<div class="comment-reply">
					{% for child_comment in comment.children %}

					<blockquote>
						<p>{{child_comment.content}}</p>
						<footer>via {{child_comment.user}} <cite title="{{child_comment.timestamp|timesince}}">{{child_comment.timestamp|timesince}}</cite></footer>
					</blockquote>
					{% endfor%}
					{% if request.user.is_authenticated %}
					<form method="POST" action=".">
						{{comment_form|crispy}}
						<input type="hidden" name="parent_id" value='{{comment.id}}'>
						<input type="submit" name="" value="Reply" class="btn btn-default">{% csrf_token %}
					</form>
					{% else %}
					<p>You must login to comment</p>
					{% endif %}
				</div>
			</blockquote>
			<hr/>
		{%endfor%}
	</div>

	<a href="https://www.facebook.com/sharer/sharer.php?u={{request.build_absolute_uri}}">
	Facebook
	</a>
	<a href="https://twitter.com/home?status={{object_list.content|truncatechars:80|urlify}}%20{{request.build_absolute_uri}}">
	Twitter
	</a>
	<a href="https://www.linkedin.com/shareArticle?mini=true&url={{request.build_absolute_uri}}&title={{instance.title}}&summary={{object_list.content|truncatechars:80|urlify}}&source={{request.build_absolute_uri}}">
	Linkedin
	</a>
	<a href="http://www.reddit.com/submit?url={{request.build_absolute_uri}}/&title={{object_list.content|truncatechars:80|urlify}}">Reddit</a>

	<a href='https://plus.google.com/share?url={{request.build_absolute_uri}}'>Google Plus</a>
	</br>
	{{object_list.updated_at}}</br>
</div>
{% endblock %}